#!/bin/bash

LOGFILE="/var/log/tanos.log"

function init() {
    case $1 in
        -l | -list)
            echo "Listando servicios..."
            systemctl list-units --type=service --all | grep -E 'nftables|ssh|cron|crontab|dnf-automatic'
            echo "[$(date)] Servicios listados" >> "$LOGFILE"
            ;;
        -s | -status)
            if [ -z "$2" ]; then
                echo "Por favor, especifique un servicio para verificar su estado."
                exit 1
            fi
            echo "Verificando el estado del servicio: $2"
            systemctl status "$2"
            echo "[$(date)] Verifici칩n de estado del servicio: $2" >> "$LOGFILE"
            ;;
        -r | -restart)
            if [ -z "$2" ]; then
                echo "Por favor, especifique un servicio para reiniciar."
                exit 1
            fi
            echo "Reiniciando el servicio: $2"
            systemctl restart "$2"
            echo "Servicio $2 reiniciado."
            echo "[$(date)] Servicio $2 reiniciado" >> "$LOGFILE"
            ;;
        -k | -kill)
            if [ -z "$2" ]; then
                echo "Por favor, especifique un servicio para detener."
                exit 1
            fi
            echo "Deteniendo el servicio: $2"
            systemctl stop "$2"
            echo "Servicio $2 detenido."
            echo "[$(date)] Servicio $2 detenido" >> "$LOGFILE"
            ;;
        -a | -active)
            echo "Listando servicios activos..."
            systemctl list-units --type=service --state=active | grep -E 'nftables|ssh|cron|crontab|dnf-automatic'
            echo "[$(date)] Servicios activos lsitados" >> "$LOGFILE"
            ;;
        -h | -help)
            echo "Uso: $0 [opci칩n] [servicio]"
            echo "Opciones:"
            echo "  -l, --list       Listar todos los servicios"
            echo "  -s, --status     Verificar el estado de un servicio"
            echo "  -r, --restart    Reiniciar un servicio"
            echo "  -k, --kill       Detener un servicio"
            echo "  -a, --active     Listar servicios activos"
            echo "  -h, --help       Mostrar este mensaje de ayuda"
            ;;
        *)
            echo "Opci칩n no v치lida. Use -h o --help para ver las opciones disponibles."
            exit 1
            ;;
    esac
}

init "$@"