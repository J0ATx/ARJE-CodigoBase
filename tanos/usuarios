#!/bin/bash

LOGFILE="/var/log/tanos.log"

function init() {
    case $1 in
        -l | -list)
            echo "Listando usuarios..."
            getent passwd | grep -E '/bin/bash|/bin/sh|/bin/zsh' | awk -F: '{print $1}'
            echo "[$(date)] Usuarios listados" >> "$LOGFILE"
            ;;
        -a | -add)
            read -p "Ingrese el nombre del nuevo usuario: " username
            read -p "Ingrese el nombre completo del usuario: " fullname
            read -p "Ingrese el grupo del usuario ('Operarios' o 'Administrativos'): " group
            if [[ "$group" != "Operarios" && "$group" != "Administrativos" ]]; then
                echo "Grupo inválido. Use 'Operarios' o 'Administrativos'."
                exit 1
            fi
            sudo useradd -m -G "$group" "$username"
            sudo chfn -f "$fullname" "$username"
            sudo passwd "$username"
            echo "[$(date)] Usuario añadido al sistema: $username ($fullname, grupo: $group)" >> "$LOGFILE"
            ;;
        -d | -delete)
            read -p "Ingrese el nombre del usuario a eliminar: " username
            sudo userdel -r "$username"
            echo "[$(date)] Usuario eliminado del sistema: $username" >> "$LOGFILE"
            ;;
        -g | -groups)
            echo "Listando grupos..."
            getent group | awk -F: '$3 >= 1000 {print $1}'
            echo "[$(date)] Grupos listados" >> "$LOGFILE"
            ;;
        -h | -help)
            echo "Uso: $0 [opción]"
            echo "Opciones:"
            echo "  -l, --list       Listar los usuarios del sistema creados manualmente"
            echo "  -a, --add        Añadir un nuevo usuario"
            echo "  -d, --delete     Eliminar un usuario existente"
            echo "  -g, --groups     Listar los grupos del sistema creados manualmente"
            echo "  -h, --help       Mostrar este mensaje de ayuda"
            ;;
        *)
            echo "Opción no válida. Use -h o --help para ver las opciones disponibles."
            exit 1
            ;;
    esac
}

init "$@"